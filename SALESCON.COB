       IDENTIFICATION DIVISION.
       PROGRAM-ID. SALES-CONSOLIDATOR.
       AUTHOR. DESENVOLVEDOR.
       DATE-WRITTEN. 2025-01-08.
       
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT SALES-FILE-1 ASSIGN TO "SALES_REGION1.DAT"
               ORGANIZATION IS LINE SEQUENTIAL.
           SELECT SALES-FILE-2 ASSIGN TO "SALES_REGION2.DAT"
               ORGANIZATION IS LINE SEQUENTIAL.
           SELECT CONSOLIDATED-SALES ASSIGN TO "CONSOLIDATED_SALES.DAT"
               ORGANIZATION IS LINE SEQUENTIAL.
           SELECT SALES-SUMMARY-REPORT ASSIGN TO "SALES_SUMMARY.RPT"
               ORGANIZATION IS LINE SEQUENTIAL.
       
       DATA DIVISION.
       FILE SECTION.
       FD SALES-FILE-1.
       01 SALES-RECORD-1.
           05 SR1-REGION         PIC X(10).
           05 SR1-PRODUCT-ID     PIC X(10).
           05 SR1-QUANTITY       PIC 9(5).
           05 SR1-AMOUNT         PIC 9(7)V99.
       
       FD SALES-FILE-2.
       01 SALES-RECORD-2.
           05 SR2-REGION         PIC X(10).
           05 SR2-PRODUCT-ID     PIC X(10).
           05 SR2-QUANTITY       PIC 9(5).
           05 SR2-AMOUNT         PIC 9(7)V99.
       
       FD CONSOLIDATED-SALES.
       01 CONSOLIDATED-RECORD.
           05 CS-REGION          PIC X(10).
           05 CS-PRODUCT-ID      PIC X(10).
           05 CS-QUANTITY        PIC 9(5).
           05 CS-AMOUNT          PIC 9(7)V99.
       
       FD SALES-SUMMARY-REPORT.
       01 REPORT-LINE          PIC X(132).
       
       WORKING-STORAGE SECTION.
       01 WS-EOF-SALES-1       PIC X VALUE 'N'.
       01 WS-EOF-SALES-2       PIC X VALUE 'N'.
       
       01 WS-TOTAL-SALES-AMOUNT PIC 9(9)V99 VALUE ZERO.
       01 WS-TOTAL-SALES-QUANTITY PIC 9(7) VALUE ZERO.
       
       01 WS-REGION-TOTALS.
           05 WS-REGION-NAME     PIC X(10).
           05 WS-REGION-AMOUNT   PIC 9(9)V99 VALUE ZERO.
           05 WS-REGION-QUANTITY PIC 9(7) VALUE ZERO.
       
       01 WS-REPORT-HEADER.
           05 FILLER             PIC X(40) VALUE SPACES.
           05 FILLER             PIC X(30) VALUE "RELATORIO DE CONSOLIDACAO DE VENDAS".
           05 FILLER             PIC X(62) VALUE SPACES.
       
       01 WS-COLUMN-HEADER.
           05 FILLER             PIC X(10) VALUE "REGIAO".
           05 FILLER             PIC X(12) VALUE "PRODUTO ID".
           05 FILLER             PIC X(10) VALUE "QUANTIDADE".
           05 FILLER             PIC X(15) VALUE "VALOR".
       
       01 WS-DETAIL-LINE.
           05 DL-REGION          PIC X(10).
           05 FILLER             PIC X(2) VALUE SPACES.
           05 DL-PRODUCT-ID      PIC X(10).
           05 FILLER             PIC X(2) VALUE SPACES.
           05 DL-QUANTITY        PIC ZZZZ9.
           05 FILLER             PIC X(2) VALUE SPACES.
           05 DL-AMOUNT          PIC ZZZ,ZZZ.99.
       
       01 WS-SUMMARY-LINE.
           05 FILLER             PIC X(20) VALUE "TOTAL GERAL VENDAS: ".
           05 SL-TOTAL-AMOUNT    PIC ZZZ,ZZZ,ZZZ.99.
           05 FILLER             PIC X(5) VALUE SPACES.
           05 FILLER             PIC X(20) VALUE "TOTAL GERAL QUANT: ".
           05 SL-TOTAL-QUANTITY  PIC ZZZZZZ9.
       
       01 WS-REGION-SUMMARY-LINE.
           05 FILLER             PIC X(10) VALUE "TOTAL ".
           05 RSL-REGION-NAME    PIC X(10).
           05 FILLER             PIC X(5) VALUE SPACES.
           05 FILLER             PIC X(10) VALUE "VALOR: ".
           05 RSL-REGION-AMOUNT  PIC ZZZ,ZZZ.99.
           05 FILLER             PIC X(5) VALUE SPACES.
           05 FILLER             PIC X(10) VALUE "QUANT: ".
           05 RSL-REGION-QUANTITY PIC ZZZZZZ9.
       
       PROCEDURE DIVISION.
       MAIN-LOGIC.
           PERFORM INITIALIZE-PROGRAM.
           PERFORM PROCESS-SALES-FILES.
           PERFORM FINALIZE-PROGRAM.
           STOP RUN.
       
       INITIALIZE-PROGRAM.
           OPEN INPUT SALES-FILE-1.
           OPEN INPUT SALES-FILE-2.
           OPEN OUTPUT CONSOLIDATED-SALES.
           OPEN OUTPUT SALES-SUMMARY-REPORT.
           
           MOVE WS-REPORT-HEADER TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE SPACES TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE WS-COLUMN-HEADER TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE SPACES TO REPORT-LINE.
           WRITE REPORT-LINE.
       
       PROCESS-SALES-FILES.
           PERFORM READ-SALES-FILE-1.
           PERFORM UNTIL WS-EOF-SALES-1 = 'Y'
               PERFORM PROCESS-SINGLE-RECORD-1
               PERFORM READ-SALES-FILE-1
           END-PERFORM.
           
           PERFORM READ-SALES-FILE-2.
           PERFORM UNTIL WS-EOF-SALES-2 = 'Y'
               PERFORM PROCESS-SINGLE-RECORD-2
               PERFORM READ-SALES-FILE-2
           END-PERFORM.
       
       READ-SALES-FILE-1.
           READ SALES-FILE-1
               AT END MOVE 'Y' TO WS-EOF-SALES-1
           END-READ.
       
       READ-SALES-FILE-2.
           READ SALES-FILE-2
               AT END MOVE 'Y' TO WS-EOF-SALES-2
           END-READ.
       
       PROCESS-SINGLE-RECORD-1.
           MOVE SR1-REGION TO CS-REGION.
           MOVE SR1-PRODUCT-ID TO CS-PRODUCT-ID.
           MOVE SR1-QUANTITY TO CS-QUANTITY.
           MOVE SR1-AMOUNT TO CS-AMOUNT.
           WRITE CONSOLIDATED-RECORD.
           
           ADD SR1-AMOUNT TO WS-TOTAL-SALES-AMOUNT.
           ADD SR1-QUANTITY TO WS-TOTAL-SALES-QUANTITY.
           
           MOVE SR1-REGION TO DL-REGION.
           MOVE SR1-PRODUCT-ID TO DL-PRODUCT-ID.
           MOVE SR1-QUANTITY TO DL-QUANTITY.
           MOVE SR1-AMOUNT TO DL-AMOUNT.
           MOVE WS-DETAIL-LINE TO REPORT-LINE.
           WRITE REPORT-LINE.
           
           PERFORM ACCUMULATE-REGION-TOTALS USING SR1-REGION, SR1-AMOUNT, SR1-QUANTITY.
       
       PROCESS-SINGLE-RECORD-2.
           MOVE SR2-REGION TO CS-REGION.
           MOVE SR2-PRODUCT-ID TO CS-PRODUCT-ID.
           MOVE SR2-QUANTITY TO CS-QUANTITY.
           MOVE SR2-AMOUNT TO CS-AMOUNT.
           WRITE CONSOLIDATED-RECORD.
           
           ADD SR2-AMOUNT TO WS-TOTAL-SALES-AMOUNT.
           ADD SR2-QUANTITY TO WS-TOTAL-SALES-QUANTITY.
           
           MOVE SR2-REGION TO DL-REGION.
           MOVE SR2-PRODUCT-ID TO DL-PRODUCT-ID.
           MOVE SR2-QUANTITY TO DL-QUANTITY.
           MOVE SR2-AMOUNT TO DL-AMOUNT.
           MOVE WS-DETAIL-LINE TO REPORT-LINE.
           WRITE REPORT-LINE.
           
           PERFORM ACCUMULATE-REGION-TOTALS USING SR2-REGION, SR2-AMOUNT, SR2-QUANTITY.
       
       ACCUMULATE-REGION-TOTALS USING P-REGION, P-AMOUNT, P-QUANTITY.
           IF WS-REGION-NAME = SPACES OR WS-REGION-NAME NOT = P-REGION
               IF WS-REGION-NAME NOT = SPACES
                   PERFORM WRITE-REGION-SUMMARY
               END-IF.
               MOVE P-REGION TO WS-REGION-NAME.
               MOVE ZERO TO WS-REGION-AMOUNT.
               MOVE ZERO TO WS-REGION-QUANTITY.
           END-IF.
           ADD P-AMOUNT TO WS-REGION-AMOUNT.
           ADD P-QUANTITY TO WS-REGION-QUANTITY.
       
       WRITE-REGION-SUMMARY.
           MOVE WS-REGION-NAME TO RSL-REGION-NAME.
           MOVE WS-REGION-AMOUNT TO RSL-REGION-AMOUNT.
           MOVE WS-REGION-QUANTITY TO RSL-REGION-QUANTITY.
           MOVE SPACES TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE WS-REGION-SUMMARY-LINE TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE SPACES TO REPORT-LINE.
           WRITE REPORT-LINE.
       
       FINALIZE-PROGRAM.
           PERFORM WRITE-REGION-SUMMARY. *> Write last region summary
           
           MOVE SPACES TO REPORT-LINE.
           WRITE REPORT-LINE.
           MOVE WS-TOTAL-SALES-AMOUNT TO SL-TOTAL-AMOUNT.
           MOVE WS-TOTAL-SALES-QUANTITY TO SL-TOTAL-QUANTITY.
           MOVE WS-SUMMARY-LINE TO REPORT-LINE.
           WRITE REPORT-LINE.
           
           CLOSE SALES-FILE-1.
           CLOSE SALES-FILE-2.
           CLOSE CONSOLIDATED-SALES.
           CLOSE SALES-SUMMARY-REPORT.
           
           DISPLAY "CONSOLIDACAO DE DADOS DE VENDAS CONCLUIDA."
           DISPLAY "TOTAL GERAL DE VENDAS: " WS-TOTAL-SALES-AMOUNT.
           DISPLAY "TOTAL GERAL DE QUANTIDADE: " WS-TOTAL-SALES-QUANTITY.


